<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Transcription App</title>
  <!-- Link to external CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="{{ url_for('static', filename='image/logo.png') }}" alt="Logo" class="logo">
      <p class="tagline">Transcribe your clinic letter seamlessly in seconds.</p>
      <p class="subtitle">Developed by doctors for doctors.</p>
    </div>

    <div class="tabs">
      <button class="tab active" id="record-tab">Record Audio</button>
      <button class="tab" id="upload-tab">Upload Audio</button>
    </div>

    <!-- Recording Section -->
    <div class="tab-content" id="record-content">
      <button class="btn record-btn" id="start-record">Start Recording</button>
      <button class="btn" id="stop-record">Stop Recording</button>

      <canvas id="waveform"></canvas>
      <audio id="audio-player" controls></audio>

      <div class="audio-controls">
        <button class="btn rewind">Rewind 10s</button>
        <button class="btn fastforward">Fast Forward 10s</button>
      </div>
    </div>

    <!-- Upload Section -->
    <div class="tab-content hidden" id="upload-content">
      <div class="upload-area" id="upload-area">
        <p>Drag and drop an audio file here, or click to select a file</p>
        <input type="file" id="file-input" accept="audio/*" class="hidden">
      </div>
      <p id="file-name"></p>
    </div>

    <!-- Process Button -->
    <button class="btn process-btn" id="process-audio">Transcribe Audio</button>

    <!-- Transcription Output -->
    <div class="transcription-output hidden" id="transcription-output">
      <h2>Transcribed Medical Letter</h2>
      <p id="transcribed-text"></p>
      <button class="btn download-btn" id="download-docx">Download as Word File</button>
    </div>
  </div>

  <!-- JavaScript for handling file uploads, recording, and transcriptions -->
  <script>
    // Add event listeners and logic for recording, uploading files, and processing audio
    document.addEventListener('DOMContentLoaded', function() {
      const recordTab = document.getElementById('record-tab');
      const uploadTab = document.getElementById('upload-tab');
      const recordContent = document.getElementById('record-content');
      const uploadContent = document.getElementById('upload-content');
      const fileInput = document.getElementById('file-input');
      const processAudioButton = document.getElementById('process-audio');

      // Toggle between Record and Upload tabs
      recordTab.addEventListener('click', function() {
        recordContent.classList.remove('hidden');
        uploadContent.classList.add('hidden');
      });

      uploadTab.addEventListener('click', function() {
        recordContent.classList.add('hidden');
        uploadContent.classList.remove('hidden');
      });

      // Handle file upload
      fileInput.addEventListener('change', function(event) {
        const file = event.target.files[0];
        if (file) {
          document.getElementById('file-name').textContent = 'File selected: ' + file.name;
        }
      });

      // Process audio (sending to Flask backend)
      processAudioButton.addEventListener('click', function() {
        const formData = new FormData();
        const file = fileInput.files[0];
        if (file) {
          formData.append('audio_file', file);
          
          // Sending file to Flask backend (/transcribe endpoint)
          fetch('/transcribe', {
            method: 'POST',
            body: formData
          })
          .then(response => response.json())
          .then(data => {
            document.getElementById('transcribed-text').textContent = data.transcribedText;
            document.getElementById('transcription-output').classList.remove('hidden');
          })
          .catch(error => console.error('Error:', error));
        }
      });
    });
  </script>
</body>
</html>
