<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Transcription App</title>
  <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="/static/image/logo.png" alt="Logo" class="logo">
      <p class="tagline">Transcribe your clinic letter seamlessly in seconds.</p>
      <p class="subtitle">Developed by doctors for doctors.</p>
    </div>

    <div class="tabs">
      <button class="tab active" id="record-tab">Record Audio</button>
      <button class="tab" id="upload-tab">Upload Audio</button>
    </div>

    <!-- Recording Section -->
    <div class="tab-content" id="record-content">
      <button class="btn record-btn" id="start-record">Start Recording</button>
      <button class="btn" id="stop-record">Stop Recording</button>

      <canvas id="waveform"></canvas>
      <audio id="audio-player" controls></audio>

      <div class="audio-controls">
        <button class="btn rewind">Rewind 10s</button>
        <button class="btn fastforward">Fast Forward 10s</button>
      </div>
    </div>

    <!-- Upload Section -->
    <div class="tab-content hidden" id="upload-content">
      <div class="upload-area" id="upload-area">
        <p>Drag and drop an audio file here, or click to select a file</p>
        <input type="file" id="file-input" accept="audio/*" class="hidden">
      </div>
      <p id="file-name"></p>
    </div>

    <!-- Process Button -->
    <button class="btn process-btn" id="process-audio">Transcribe Audio</button>

    <!-- Transcription Output -->
    <div class="transcription-output hidden" id="transcription-output">
      <h2>Transcribed Medical Letter</h2>
      <p id="transcribed-text"></p>
      <button class="btn download-btn" id="download-docx">Download as Word File</button>
    </div>
  </div>

  <script>
    const fileInput = document.getElementById('file-input');
    const processAudioButton = document.getElementById('process-audio');
    const transcriptionOutput = document.getElementById('transcription-output');
    const transcribedText = document.getElementById('transcribed-text');

    // Drag-and-drop event listeners
    document.getElementById('upload-area').addEventListener('dragover', (event) => {
      event.preventDefault();
    });

    document.getElementById('upload-area').addEventListener('drop', (event) => {
      event.preventDefault();
      const file = event.dataTransfer.files[0];
      if (file) {
        fileInput.files = event.dataTransfer.files;
        document.getElementById('file-name').textContent = `File selected: ${file.name}`;
      }
    });

    // Process audio (sending to Flask backend)
    processAudioButton.addEventListener('click', function() {
      const formData = new FormData();
      const file = fileInput.files[0];
      if (file) {
        formData.append('audio_file', file);

        // Sending file to Flask backend (/transcribe endpoint)
        fetch('/transcribe', {
          method: 'POST',
          body: formData
        })
        .then(response => response.json())
        .then(data => {
          transcribedText.textContent = data.transcribedText;
          transcriptionOutput.classList.remove('hidden');
        })
        .catch(error => console.error('Error:', error));
      }
    });
  </script>
</body>
</html>
